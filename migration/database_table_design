CREATE TABLE user (
    id SERIAL,
    member_id UUID UNIQUE,
    mobile VARCHAR(20) NOT NULL UNIQUE,
    name VARCHAR(50) NOT NULL,
    short_name VARCHAR(10) NOT NULL,
    status VARCHAR(10) NOT NULL,
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    delete_time TIMESTAMP
);

CREATE INDEX member_name ON member (name);

CREATE TABLE group_info (
    id  SERIAL,
    group_id UUID UNIQUE,
    creator_id UUID NOT NULL,
    name VARCHAR(50) NOT NULL,
    type VARCHAR(10) NOT NULL,
    status VARCHAR(10) NOT NULL,
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    delete_time TIMESTAMP
);

CREATE TABLE event (
    id SERIAL,
    event_id UUID UNIQUE,
    group_id UUID NOT NULL,
    creator_id UUID NOT NULL,
    name VARCHAR(50) NOT NULL,
    type VARCHAR(10) NOT NULL,
    status VARCHAR(10) NOT NULL,
    params JSONB NOT NULL,
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    delete_time TIMESTAMP
);

CREATE TABLE group_member (
    id SERIAL,
    group_id UUID NOT NULL,
    member_id UUID NOT NULL,
    status VARCHAR(10) NOT NULL,
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    delete_time TIMESTAMP
);

ALTER TABLE group_member ADD CONSTRAINT uniq_member_group UNIQUE(group_id, member_id);
CREATE INDEX group_member_ids ON group_member (group_id, member_id);


CREATE TABLE event_member (
    id SERIAL,
    event_id UUID NOT NULL,
    group_id UUID NOT NULL,
    member_id UUID NOT NULL,
    action VARCHAR(10) NOT NULL,
    status VARCHAR(10) NOT NULL,
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    delete_time TIMESTAMP
);

ALTER TABLE event_member ADD CONSTRAINT uniq_member_event UNIQUE(event_id, member_id);
CREATE INDEX event_member_index ON event_member (event_id, member_id);
